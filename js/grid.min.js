var $event=$.event,$special,resizeTimeout;$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler)},teardown:function(){$(this).off("resize",$special.handler)},handler:function(i,e){var t=this,s=arguments,n=function(){i.type="debouncedresize",$event.dispatch.apply(t,s)};resizeTimeout&&clearTimeout(resizeTimeout),e?n():resizeTimeout=setTimeout(n,$special.threshold)},threshold:250};var BLANK="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";$.fn.imagesLoaded=function(i){function o(){var s=$(r),a=$(h);t&&(h.length?t.reject(n,s,a):t.resolve(n)),$.isFunction(i)&&i.call(e,n,s,a)}function d(i,e){i.src!==BLANK&&-1===$.inArray(i,a)&&(a.push(i),e?h.push(i):r.push(i),$.data(i,"imagesLoaded",{isBroken:e,src:i.src}),s&&t.notifyWith($(i),[e,n,$(r),$(h)]),n.length===a.length&&(setTimeout(o),n.unbind(".imagesLoaded")))}var e=this,t=$.isFunction($.Deferred)?$.Deferred():0,s=$.isFunction(t.notify),n=e.find("img").add(e.filter("img")),a=[],r=[],h=[];return $.isPlainObject(i)&&$.each(i,function(e,s){"callback"===e?i=s:t&&t[e](s)}),n.length?n.bind("load.imagesLoaded error.imagesLoaded",function(i){d(i.target,"error"===i.type)}).each(function(i,e){var t=e.src,s=$.data(e,"imagesLoaded");return s&&s.src===t?void d(e,s.isBroken):e.complete&&void 0!==e.naturalWidth?void d(e,0===e.naturalWidth||0===e.naturalHeight):void((e.readyState||e.complete)&&(e.src=BLANK,e.src=t))}):o(),t?t.promise(e):e};var Grid=function(){function g(e){c=$.extend(!0,{},c,e),i.imagesLoaded(function(){u(!0),w(),m()})}function p(i){e=e.add(i),i.each(function(){var i=$(this);i.data({offsetTop:i.offset().top,height:i.height()})}),v(i)}function u(i){e.each(function(){var e=$(this);e.data("offsetTop",e.offset().top),i&&e.data("height",e.height())})}function m(){v(e),r.on("debouncedresize",function(){n=0,s=-1,u(),w();var i=$.data(this,"preview");"undefined"!=typeof i&&T()})}function v(i){i.on("click","span.og-close",function(){return T(),!1}).children("a").on("click",function(i){var e=$(this).parent();return t===e.index()?T():A(e),!1})}function w(){h={width:r.width(),height:r.height()}}function A(i){var e=$.data(this,"preview"),t=i.data("offsetTop");if(n=0,"undefined"!=typeof e){if(s===t)return e.update(i),!1;t>s&&(n=e.height),T()}s=t,e=$.data(this,"preview",new x(i)),e.open()}function T(){t=-1;var i=$.data(this,"preview");i.close(),$.removeData(this,"preview")}function x(i){this.$item=i,this.expandedIdx=this.$item.index(),this.create(),this.update()}var h,i=$("#og-grid"),e=i.children("li"),t=-1,s=-1,n=0,a=10,r=$(window),o=$("html, body"),d={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},f=d[Modernizr.prefixed("transition")],l=Modernizr.csstransitions,c={minHeight:300,speed:350,easing:"ease"};return x.prototype={create:function(){this.$title=$("<h3></h3>"),this.$description=$("<p></p>"),this.$href=$('<a href="#">GitHub</a>'),this.$details=$('<div class="og-details"></div>').append(this.$title,this.$description,this.$href),this.$loading=$('<div class="og-loading"></div>'),this.$fullimage=$('<div class="og-fullimg"></div>').append(this.$loading),this.$closePreview=$('<span class="og-close"></span>'),this.$previewInner=$('<div class="og-expander-inner"></div>').append(this.$closePreview,this.$fullimage,this.$details),this.$previewEl=$('<div class="og-expander"></div>').append(this.$previewInner),this.$item.append(this.getEl()),l&&this.setTransition()},update:function(i){if(i&&(this.$item=i),-1!==t){var s=e.eq(t);s.removeClass("og-expanded"),this.$item.addClass("og-expanded"),this.positionPreview()}t=this.$item.index();var n=this.$item.children("a"),a={href:n.attr("href"),largesrc:n.data("largesrc"),title:n.data("title"),description:n.data("description")};this.$title.html(a.title),this.$description.html(a.description),this.$href.attr("href",a.href);var r=this;"undefined"!=typeof r.$largeImg&&r.$largeImg.remove(),r.$fullimage.is(":visible")&&(this.$loading.show(),$("<img/>").load(function(){var i=$(this);i.attr("src")===r.$item.children("a").data("largesrc")&&(r.$loading.hide(),r.$fullimage.find("img").remove(),r.$largeImg=i.fadeIn(350),r.$fullimage.append(r.$largeImg))}).attr("src",a.largesrc))},open:function(){setTimeout($.proxy(function(){this.setHeights(),this.positionPreview()},this),25)},close:function(){var i=this,t=function(){l&&$(this).off(f),i.$item.removeClass("og-expanded"),i.$previewEl.remove()};return setTimeout($.proxy(function(){"undefined"!=typeof this.$largeImg&&this.$largeImg.fadeOut("fast"),this.$previewEl.css("height",0);var i=e.eq(this.expandedIdx);i.css("height",i.data("height")).on(f,t),l||t.call()},this),25),!1},calcHeight:function(){var i=h.height-this.$item.data("height")-a,e=h.height;i<c.minHeight&&(i=c.minHeight,e=c.minHeight+this.$item.data("height")+a),this.height=i,this.itemHeight=e},setHeights:function(){var i=this,e=function(){l&&i.$item.off(f),i.$item.addClass("og-expanded")};this.calcHeight(),this.$previewEl.css("height",this.height),this.$item.css("height",this.itemHeight).on(f,e),l||e.call()},positionPreview:function(){var i=this.$item.data("offsetTop"),e=this.$previewEl.offset().top-n,t=this.height+this.$item.data("height")+a<=h.height?i:this.height<h.height?e-(h.height-this.height):e;o.animate({scrollTop:t},c.speed)},setTransition:function(){this.$previewEl.css("transition","height "+c.speed+"ms "+c.easing),this.$item.css("transition","height "+c.speed+"ms "+c.easing)},getEl:function(){return this.$previewEl}},{init:g,addItems:p}}();